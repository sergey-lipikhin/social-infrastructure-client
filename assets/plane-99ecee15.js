import{cf as M,cM as d,cr as b,cd as x,cl as h,ce as O,ck as s,ao as z,bE as F,cm as C}from"./index-fdfa590d.js";import{c as I,r as j,f as L}from"./sphere-8d57d872.js";function B(r){const n=r[0]*r[0]+r[4]*r[4]+r[8]*r[8],c=r[1]*r[1]+r[5]*r[5]+r[9]*r[9],u=r[2]*r[2]+r[6]*r[6]+r[10]*r[10];return Math.sqrt(Math.max(n,c,u))}function D(r,n){const c=Math.sqrt(n[0]*n[0]+n[4]*n[4]+n[8]*n[8]),u=Math.sqrt(n[1]*n[1]+n[5]*n[5]+n[9]*n[9]),e=Math.sqrt(n[2]*n[2]+n[6]*n[6]+n[10]*n[10]);return M(r,c,u,e),r}function G(r,n,c){Math.abs(r[0])>Math.abs(r[1])?M(n,0,1,0):M(n,1,0,0),d(c,r,n),b(n,n),d(n,c,r),b(c,c)}function v(r=A){return[r[0],r[1],r[2],r[3]]}function Q(r=A[0],n=A[1],c=A[2],u=A[3]){return y(r,n,c,u,j.get())}function H(r,n){return y(n[0],n[1],n[2],n[3],r)}function y(r,n,c,u,e=v()){return e[0]=r,e[1]=n,e[2]=c,e[3]=u,e}function J(r,n,c){const u=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],e=Math.abs(u-1)>1e-5&&u>1e-12?1/Math.sqrt(u):1;return c[0]=n[0]*e,c[1]=n[1]*e,c[2]=n[2]*e,c[3]=-(c[0]*r[0]+c[1]*r[1]+c[2]*r[2]),c}function K(r,n,c,u=v()){const e=c[0]-n[0],i=c[1]-n[1],o=c[2]-n[2],t=r[0]-n[0],a=r[1]-n[1],T=r[2]-n[2],E=i*T-o*a,q=o*t-e*T,P=e*a-i*t,X=E*E+q*q+P*P,p=Math.abs(X-1)>1e-5&&X>1e-12?1/Math.sqrt(X):1;return u[0]=E*p,u[1]=q*p,u[2]=P*p,u[3]=-(u[0]*r[0]+u[1]*r[1]+u[2]*r[2]),u}function R(r,n,c,u,e){const i=r.length/3;if(i<3)return!1;M(_,r[3*c],r[3*c+1],r[3*c+2]);let o=u,t=!1;for(;o<i-1&&!t;){const a=3*o;M(g,r[a],r[a+1],r[a+2]),o++,t=!C(_,g)}if(!t)return!1;for(o=Math.max(o,e),t=!1;o<i&&!t;){const a=3*o;M(N,r[a],r[a+1],r[a+2]),o++,h(l,_,g),b(l,l),h($,g,N),b($,$),t=!C(_,N)&&!C(g,N)&&Math.abs(s(l,$))<U}return t?(K(_,g,N,n),!0):(c!==0||u!==1||e!==2)&&R(r,n,0,1,2)}const U=.99619469809,_=F(),g=F(),N=F(),l=F(),$=F();function S(r,n,c){return n!==r&&H(r,n),r[3]=-s(r,c),r}function rr(r,n){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n[3]=-r[3],n}function nr(r,n,c,u){return d(N,n,r),J(c,N,u)}function cr(r,n,c,u){return m(r,n,h(I.get(),c,n),W,u)}function ur(r,n,c){return n!=null&&m(r,n.origin,n.direction,Y,c)}function er(r,n,c){return m(r,n.origin,n.vector,f.NONE,c)}function or(r,n,c){return m(r,n.origin,n.vector,f.CLAMP,c)}function tr(r,n){return k(r,n)>=0}function ir(r,n){const c=s(r,n.ray.direction),u=-k(r,n.ray.origin);if(c>-1e-6&&c<1e-6)return u>0;const e=u/c;return c>0?e<n.c1&&(n.c1=e):e>n.c0&&(n.c0=e),n.c0<=n.c1}function ar(r,n,c){const u=x(I.get(),r,-r[3]),e=V(r,h(I.get(),n,u),I.get());return O(c,e,u),c}function fr(r,n,c,u){const e=r,i=I.get(),o=I.get();G(e,i,o);const t=h(I.get(),c,n),a=L(i,t),T=L(o,t),E=L(e,t);return M(u,a,T,E)}function V(r,n,c){const u=x(I.get(),r,s(r,n));return h(c,n,u),c}function k(r,n){return s(r,n)+r[3]}function m(r,n,c,u,e){const i=s(r,c);if(i===0)return!1;let o=-(s(r,n)+r[3])/i;return u&f.CLAMP&&(o=z(o,0,1)),!(!(u&f.INFINITE_MIN)&&o<0||!(u&f.INFINITE_MAX)&&o>1)&&(O(e,n,x(e,c,o)),!0)}function Ir(r){return r}const A=[0,0,1,0];var f;(function(r){r[r.NONE=0]="NONE",r[r.CLAMP=1]="CLAMP",r[r.INFINITE_MIN=4]="INFINITE_MIN",r[r.INFINITE_MAX=8]="INFINITE_MAX"})(f||(f={}));const W=f.INFINITE_MIN|f.INFINITE_MAX,Y=f.INFINITE_MAX;export{y as A,S as C,Q as E,ir as G,ar as H,fr as J,rr as L,cr as O,nr as P,k as R,J as T,or as U,Ir as W,K as _,D as a,v as h,R as j,B as l,H as p,ur as q,er as x,tr as z};
