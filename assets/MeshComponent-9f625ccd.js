import{u as o,v as s,hR as E,fM as O,bT as P,w as v,bH as j,c$ as _,jC as A,bD as V,ct as F,s as H,f$ as g,aa as h}from"./index-fdfa590d.js";import{r as z}from"./imageUtils-c2d0d1ae.js";var y;const C=new WeakMap;let B=0,p=y=class extends j{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,n){if(e instanceof HTMLImageElement){const a={type:"image-element",src:_(e.src,n),crossOrigin:e.crossOrigin};t[r]=a}else if(e instanceof HTMLCanvasElement){const a=e.getContext("2d").getImageData(0,0,e.width,e.height),u={type:"canvas-element",imageData:this._encodeImageData(a)};t[r]=u}else if(e instanceof HTMLVideoElement){const a={type:"video-element",src:_(e.src,n),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=a}else if(e instanceof ImageData){const a={type:"image-data",imageData:this._encodeImageData(e)};t[r]=a}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const r=t.substr(t.length-4,4).toLowerCase(),n=t.substr(0,15).toLocaleLowerCase();if(r===".png"||n==="data:image/png;")return!0}return!1}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(r="")=>`d:${r},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(C.has(this.data)||C.set(this.data,++B),t(C.get(this.data))):t()}get memoryUsage(){let e=0;if(e+=this.url!=null?this.url.length:0,this.data!=null){const t=this.data;"data"in t?e+=t.data.byteLength:t instanceof HTMLImageElement?e+=t.naturalWidth*t.naturalHeight*3:t instanceof HTMLCanvasElement&&(e+=t.width*t.height*3)}return e}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new y(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return z(r,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new y({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new y({data:e}):A(y,e)}};o([s({type:String,json:{write:E}})],p.prototype,"url",null),o([s({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),s()],p.prototype,"data",null),o([O("data")],p.prototype,"writeData",null),o([P("data")],p.prototype,"readData",null),o([s({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],p.prototype,"transparent",null),o([s({json:{write:!0}})],p.prototype,"wrap",void 0),o([s({readOnly:!0})],p.prototype,"contentHash",null),p=y=o([v("esri.geometry.support.MeshTexture")],p);const b=p;let f=class extends V(j){constructor(t){super(t),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};o([s({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"offset",void 0),o([s({type:Number,nonNullable:!0,json:{write:!0}})],f.prototype,"rotation",void 0),o([s({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"scale",void 0),f=o([v("esri.geometry.support.MeshTextureTransform")],f);const D=f;var N;let c=N=class extends j{constructor(e){super(e),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=e!=null?e.get(this):null;if(r)return r;const n=new N(this.clonePropertiesWithDeduplication(t));return e!=null&&e.set(this,n),n}clonePropertiesWithDeduplication(e){var t,r,n,a;return{color:this.color!=null?this.color.clone():null,colorTexture:(t=this.colorTexture)==null?void 0:t.cloneWithDeduplication(e),normalTexture:(r=this.normalTexture)==null?void 0:r.cloneWithDeduplication(e),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(n=this.colorTextureTransform)==null?void 0:n.clone(),normalTextureTransform:(a=this.normalTextureTransform)==null?void 0:a.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let e=0;return e+=this.color!=null?16:0,this.colorTexture!=null&&(e+=this.colorTexture.memoryUsage),e+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(e+=this.normalTexture.memoryUsage),e+=this.normalTextureTransform!=null?20:0,e}};o([s({type:F,json:{write:!0}})],c.prototype,"color",void 0),o([s({type:b,json:{write:!0}})],c.prototype,"colorTexture",void 0),o([s({type:D,json:{write:!0}})],c.prototype,"colorTextureTransform",void 0),o([s({type:b,json:{write:!0}})],c.prototype,"normalTexture",void 0),o([s({type:D,json:{write:!0}})],c.prototype,"normalTextureTransform",void 0),o([s({nonNullable:!0,json:{write:!0}})],c.prototype,"alphaMode",void 0),o([s({nonNullable:!0,json:{write:!0}})],c.prototype,"alphaCutoff",void 0),o([s({nonNullable:!0,json:{write:!0}})],c.prototype,"doubleSided",void 0),c=N=o([v("esri.geometry.support.MeshMaterial")],c);const W=c;var U;let l=U=class extends W{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=e!=null?e.get(this):null;if(r)return r;const n=new U(this.clonePropertiesWithDeduplication(t));return e!=null&&e.set(this,n),n}getMemoryUsage(){let e=super.getMemoryUsage();return e+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(e+=this.emissiveTexture.memoryUsage),e+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(e+=this.occlusionTexture.memoryUsage),e+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(e+=this.metallicRoughnessTexture.memoryUsage),e+=this.metallicRoughnessTextureTransform!=null?20:0,e}clonePropertiesWithDeduplication(e){var t,r,n,a,u,M,I;return{...super.clonePropertiesWithDeduplication(e),emissiveColor:(t=this.emissiveColor)==null?void 0:t.clone(),emissiveTexture:(r=this.emissiveTexture)==null?void 0:r.cloneWithDeduplication(e),emissiveTextureTransform:(n=this.emissiveTextureTransform)==null?void 0:n.clone(),occlusionTexture:(a=this.occlusionTexture)==null?void 0:a.cloneWithDeduplication(e),occlusionTextureTransform:(u=this.occlusionTextureTransform)==null?void 0:u.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(M=this.metallicRoughnessTexture)==null?void 0:M.cloneWithDeduplication(e),metallicRoughnessTextureTransform:(I=this.metallicRoughnessTextureTransform)==null?void 0:I.clone()}}};o([s({type:F,json:{write:!0}})],l.prototype,"emissiveColor",void 0),o([s({type:b,json:{write:!0}})],l.prototype,"emissiveTexture",void 0),o([s({type:D,json:{write:!0}})],l.prototype,"emissiveTextureTransform",void 0),o([s({type:b,json:{write:!0}})],l.prototype,"occlusionTexture",void 0),o([s({type:D,json:{write:!0}})],l.prototype,"occlusionTextureTransform",void 0),o([s({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],l.prototype,"metallic",void 0),o([s({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],l.prototype,"roughness",void 0),o([s({type:b,json:{write:!0}})],l.prototype,"metallicRoughnessTexture",void 0),o([s({type:D,json:{write:!0}})],l.prototype,"metallicRoughnessTextureTransform",void 0),l=U=o([v("esri.geometry.support.MeshMaterialMetallicRoughness")],l);const k=l;var $;const S="esri.geometry.support.MeshVertexAttributes",d=H.getLogger(S);let i=$=class extends j{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return T(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},d)}castPosition(e){return e&&e instanceof Float32Array&&d.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),T(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},d)}castUv(e){return T(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},d)}castNormal(e){return T(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},d)}castTangent(e){return T(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},d)}clone(){const e={position:h(this.position),uv:h(this.uv),normal:h(this.normal),tangent:h(this.tangent),color:h(this.color)};return new $(e)}clonePositional(){const e={position:h(this.position),normal:h(this.normal),tangent:h(this.tangent),uv:this.uv,color:this.color};return new $(e)}get memoryUsage(){let e=0;return e+=this.position.byteLength,this.uv!=null&&(e+=this.uv.byteLength),this.normal!=null&&(e+=this.normal.byteLength),this.tangent!=null&&(e+=this.tangent.byteLength),this.color!=null&&(e+=this.color.byteLength),e}};function L(e,t,r,n){const{loggerTag:a,stride:u}=t;return e.length%u!=0?(n.error(a,`Invalid array length, expected a multiple of ${u}`),new r([])):e}function T(e,t,r,n,a){if(!e)return e;if(e instanceof t)return L(e,n,t,a);for(const u of r)if(e instanceof u)return L(new t(e),n,t,a);if(Array.isArray(e))return L(new t(e),n,t,a);{const u=r.map(M=>`'${M.name}'`);return a.error(`Failed to set property, expected one of ${u}, but got ${e.constructor.name}`),new t([])}}function w(e,t,r){t[r]=q(e)}function q(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}o([s({json:{write:w}})],i.prototype,"color",void 0),o([g("color")],i.prototype,"castColor",null),o([s({nonNullable:!0,json:{write:w}})],i.prototype,"position",void 0),o([g("position")],i.prototype,"castPosition",null),o([s({json:{write:w}})],i.prototype,"uv",void 0),o([g("uv")],i.prototype,"castUv",null),o([s({json:{write:w}})],i.prototype,"normal",void 0),o([g("normal")],i.prototype,"castNormal",null),o([s({json:{write:w}})],i.prototype,"tangent",void 0),o([g("tangent")],i.prototype,"castTangent",null),i=$=o([v(S)],i);var x;const R="esri.geometry.support.MeshComponent",G=H.getLogger(R);let m=x=class extends j{static from(e){return A(x,e)}constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(e){return T(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},G)}castMaterial(e){return A(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?k:W,e)}clone(){return new x({faces:h(this.faces),shading:this.shading,material:h(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const r={faces:h(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new x(r)}get memoryUsage(){let e=0;return this.faces!=null&&(e+=this.faces.byteLength),this.material!=null&&(e+=this.material.memoryUsage),e}};o([s({json:{write:!0}})],m.prototype,"faces",void 0),o([g("faces")],m.prototype,"castFaces",null),o([s({type:W,json:{write:!0}})],m.prototype,"material",void 0),o([g("material")],m.prototype,"castMaterial",null),o([s({type:String,json:{write:!0}})],m.prototype,"shading",void 0),o([s({type:Boolean})],m.prototype,"trustSourceNormals",void 0),m=x=o([v(R)],m);const X=m;export{D as a,k as c,X as g,b as m,i as p};
